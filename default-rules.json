[
	{
		"condition": {"QualifiedDomain": "l.threads.net"},
		"mapper": {"GetUrlFromQueryParam": "u"}
	},
	{
		"condition": {
			"All": [
				{"QualifiedDomain": "pixiv.net"},
				{"PathIs": "/member.php"}
			]
		},
		"mapper": {
			"All": [
				{"SetPart": {"part": "Path", "to": "/users/"}},
				{"CopyPart": {"from": {"QueryParam": "id"}, "none_to_empty_string": false, "to": "NextPathSegment"}},
				"RemoveQuery"
			]
		}
	},
	{
		"condition": {
			"All": [
				{"UnqualifiedDomain": "deviantart.com"},
				{"PathIs": "/users/outgoing"}
			]
		},
		"mapper": {"GetUrlFromQueryParam": "url"}
	},
	{
		"condition": {
			"Any": [
				{"QualifiedDomain": "t.co"},
				{"QualifiedDomain": "bit.ly"},
				{"QualifiedDomain": "pixiv.me"},
				{
					"All": [
						{"QualifiedDomain": "pawoo.net"},
						{"PathIs": "/oauth_authentications"}
					]
				},
				{"QualifiedDomain": "tr.ee"}
			]
		},
		"mapper": "ExpandShortLink"
	},

	{
		"comment": "The tracking parameters from (in order) Brave Browser, FireFox, and... I don't remember.",
		"condition": "Always",
		"mapper": {
			"RemoveQueryParams": [
				"__hsfp", "__hssc", "__hstc", "__s", "_gl", "_hsenc", "_kx", "_openstat", "at_recipient_id", "at_recipient_list",
				"bsft_clkid", "bsft_uid", "dclid", "fb_action_ids", "fb_comment_id", "fbclid", "gbraid", "gclid", "guce_referrer",
				"guce_referrer_sig", "hsCtaTracking", "irclickid", "mc_eid", "ml_subscriber", "ml_subscriber_hash", "msclkid", "mtm_cid",
				"oft_c", "oft_ck", "oft_d", "oft_id", "oft_ids", "oft_k", "oft_lk", "oft_sk", "oly_anon_id", "oly_enc_id", "pk_cid",
				"rb_clickid", "s_cid", "ss_email_id", "twclid", "unicorn_click_id", "vero_conv", "vero_id", "vgo_ee", "wbraid",
				"wickedid", "yclid", "ymclid", "ysclid",

				"mc_eid", "oly_anon_id", "oly_enc_id", "__s",
				"vero_id", "_hsenc", "mkt_tok", "fbclid",

				"ltcld"
			]
		}
	},

	{
		"condition": {
			"Any": [
				{"QualifiedDomain": "instagram.com"},
				{"QualifiedDomain": "threads.net"}
			]
		},
		"mapper": {"RemoveQueryParams": ["igshid", "igsh"]}
	},
	{
		"condition": {
			"All": [
				{"UnqualifiedDomain": "tumblr.com"},
				{"QueryHasParam": "redirect_to"}
			]
		},
		"mapper": {
			"All": [
				{"GetPathFromQueryParam": "redirect_to"},
				"RemoveQuery"
			]
		}
	},
  {
    "condition": {
			"All": [
				{"FlagSet": "tumblr-strip-reblogs"},
				{"UnqualifiedDomain": "tumblr.com"},
				{"PartContains": {"part": "Path", "where": {"After": 1}, "value": "/"}},
				{"CommandExists": {"program": "gallery-dl"}},
				{"CommandExists": {"program": "jq"}}
			]
		},
    "mapper": {
      "ReplaceWithCommandOutput": {
        "program": "gallery-dl",
        "args": ["--dump-json", "{}"],
        "output_handling": {
          "PipeStdoutTo": {
            "program": "jq",
            "args": ["-r", ".[0][1][\"reblogged_root_url\"]"]
          }
        }
      }
    }
  },
	{
		"condition": {"UnqualifiedAnyTld": "google"},
		"mapper": {"AllowQueryParams": ["hl", "q", "tbm"]}
	},
	{
		"condition": {"QualifiedDomain": "youtu.be"},
		"mapper": {
			"All": [
				{"SetHost": "youtube.com"},
				{"CopyPart": {"from": {"PathSegment": 0}, "to": {"QueryParam": "v"}}},
				{"SetPart": {"part": "Path", "to": "watch"}}
			]
		}
	},
	{
		"condition": {"QualifiedDomain": "youtube.com"},
		"mapper": {"RemoveQueryParams": ["si"]}
	},
	{
		"condition": {
			"All": [
				{"FlagSet": "unshort-youtube"},
				{"PartIs": {"part": {"PathSegment": 0}, "value": "shorts"}}
			]
		},
		"mapper": {
			"All": [
				{"CopyPart": {"from": {"PathSegment": 1} , "to": {"QueryParam": "v"}}},
				{"SetPart": {"part": "Path", "to": "watch"}}
			]
		}
	},
	{
		"condition": {
			"Any": [
				{"QualifiedDomain": "twitter.com"},
				{"QualifiedDomain": "vxtwitter.com"},
				{"QualifiedDomain": "fxtwitter.com"},
				{"QualifiedDomain": "x.com"}
			]
		},
		"mapper": {
			"All": [
				{"SetHost": "twitter.com"},
				"RemoveQuery"
			]
		}
	},
	{
		"comment": "Discord currently can't embed any twitter link. Not just videos.",
		"condition": {"FlagSet": "discord-compatibility"},
		"mapper": {"SetHost": "vxtwitter.com"}
	},
	{
		"condition": {
			"Any": [
				{"UnqualifiedDomain": "reddit.com"   },
				{"QualifiedDomain"  : "theonion.com" },
				{"QualifiedDomain"  : "teespring.com"},
				{"QualifiedDomain"  : "donmai.com"   },
				{"UnqualifiedDomain": "tumblr.com"   },
				{"QualifiedDomain"  : "instagram.com"}
			]
		},
		"mapper": "RemoveQuery"
	},
	{
		"condition": {
			"All": [
				{"PartIs": {"part": {"PathSegment": 1}, "value": "dp"}},
				{"UnqualifiedAnyTld": "amazon"}
			]
		},
		"mapper": {
			"All": [
				"RemoveQuery",
				{"RemovePathSegments": [0, 3]}
			]
		}
	},
	{
		"condition": {
			"All": [
				{"QualifiedDomain": "bsky.app"},
				{"PartContains": {"part": "Path", "where": "End", "value": ".bsky"}}
			]
		},
		"mapper": {
			"ModifyPart": {
				"part": "Path",
				"how": {"Append": ".social"}
			}
		}
	}
]
