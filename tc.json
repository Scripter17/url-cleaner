{
  "cache_path": "tc-cache.sqlite",
  "commons": {
    "string_modifications": {
      "state_set": {"Map": {
        "0,0": "0",
        "0,1": "1",
        "1,0": "1",
        "1,1": "0"
      }},
      "state_move": {"Map": {
        "0,0": "right",
        "0,1": "right",
        "1,0": "left",
        "1,1": "right"
      }},
      "state_map": {"Map": {
        "0,0": "1",
        "0,1": "0",
        "1,0": "stop",
        "1,1": "0"
      }}
    },
    "string_sources": {
      "key": {"Join": {"sources": [{"ScratchpadVar": "state"}, ",", {"ScratchpadVar": "read"}]}}
    },
    "mappers": {
      "move-right": {"SetScratchpadVar": {
        "name": "tape",
        "value": {"Join": {
          "sources": [
            {"Modified": {"source": {"ScratchpadVar": "tape"}, "modification": {"Remove": 0}}},
            {"Modified": {"source": {"ScratchpadVar": "tape"}, "modification": {"KeepRange": {"start": 0, "end": 1}}}}
          ]
        }}
      }},
      "move-left": {"SetScratchpadVar": {
        "name": "tape",
        "value": {"Join": {
          "sources": [
            {"Modified": {"source": {"ScratchpadVar": "tape"}, "modification": {"KeepRange": {"start": -1}}}},
            {"Modified": {"source": {"ScratchpadVar": "tape"}, "modification": {"Remove": -1}}}
          ]
        }}
      }}
    },
    "rules": {
      "step": {
        "condition": {"Not": {"StringIs": {"source": {"ScratchpadVar": "state"}, "value": "stop"}}},
        "mapper": {"All": [
          {"SetScratchpadVar": {
            "name": "read",
            "value": {
              "Modified": {
                "source": {"ScratchpadVar": "tape"},
                "modification": {"KeepRange": {
                  "start": 0,
                  "end": 1
                }}
              }
            }
          }},
          {"SetScratchpadVar": {
            "name": "tape",
            "value": {"Join": {
              "sources": [
                {"Modified": {"source": {"Common": {"name": "key"}}, "modification": {"Common": {"name": "state_set"}}}},
                {"Modified": {"source": {"ScratchpadVar": "tape"}, "modification": {"KeepRange": {"start": 1}}}}
              ]
            }}
          }},
          {"Common": {"name": {"Join": {"sources": ["move-", {"Modified": {"source": {"Common": {"name": "key"}}, "modification": {"Common": {"name": "state_move"}}}}]}}}},
          {"SetScratchpadVar": {
            "name": "state",
            "value": {"Modified": {"source": {"Common": {"name": "key"}}, "modification": {"Common": {"name": "state_map"}}}}
          }},
          {"Rules": [{"Common": {"name": "step"}}]}
        ]}
      }
    }
  },
  "rules": [
    {
      "condition": "Always",
      "mapper": {"All": [
        {"SetScratchpadVar": {
          "name": "state",
          "value": "0"
        }},
        {"SetScratchpadVar": {
          "name": "tape",
          "value": {"Part": {"QueryParam": "tape"}}
        }}
      ]}
    },
    {"Common": {"name": "step"}},
    {
      "condition": "Always",
      "mapper": {"SetPart": {
        "part": {"QueryParam": "tape"},
        "value": {"ScratchpadVar": "tape"}
      }}
    }
  ]
}
